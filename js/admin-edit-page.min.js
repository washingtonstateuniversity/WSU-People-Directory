!function(e,t,o){function s(){e.ajax({url:t.wsuwp_people_edit_page.ajax_url,data:{action:"check_inserted_profiles",nonce:t.wsuwp_people_edit_page.nonce,page:t.wsuwp_people_edit_page.page_id}}).done(function(t){"false"===t?setTimeout(s,6e3):(e(".wsu-people-admin-wrapper").removeClass("loading"),e(".importing-profiles").remove(),p(JSON.parse(t)),i())})}function i(){e(".has-photo .photo img").each(function(){e(this).attr("src",e(this).data("photo"))})}function n(o,s,i,n){e.ajax({url:t.wsuwp_people_edit_page.rest_url,data:o}).done(function(e){s=e.reduceRight(function(e,t){return e.unshift(t),e},s),i===n&&l(s)})}function l(t){z.find(".spinner").remove(),t.sort(a),p(t),i(),r(),e(".wsu-people-directory-options.add").removeClass("open").children("div").hide(),e(".wsu-people-directory-options, .wsu-people-bulk-actions").slideDown()}function a(e,t){return e.last_name<t.last_name?-1:e.last_name>t.last_name?1:0}function p(t){e.each(t,function(t,o){""!==o.nid&&-1===e.inArray(o.id,N)&&-1===e.inArray(o.nid,L)&&(f.val(function(){return this.value+" "+o.id}),z.append(J({nid:o.nid,id:o.id,has_photo:o.photos&&0<o.photos.length?" has-photo":"",slug:o.slug,name:o.title.rendered,photo:o.photos&&0<o.photos.length?o.photos[0].thumbnail:"",title:0<o.working_titles.length?o.working_titles[0]:o.position_title,email:o.email_alt?o.email_alt:o.email,phone:o.phone_alt?o.phone_alt:o.phone+o.phone_ext,office:o.office_alt?o.office_alt:o.office,address:o.address,website:o.website,content:o.content.rendered})),L.push(o.nid),N.push(o.id))})}function r(){var t=z.find(".wsu-person").map(function(){return e(this).data("profile-id")}).get();f.val(t.join(" "))}function c(o,s){e.post(t.wsuwp_people_edit_page.ajax_url,o).done(function(){s.removeClass("active"),z.sortable("option","disabled",!1),e("body").removeClass("person-modal-open")})}var d=e("#page_template"),u=e("#wsuwp-people-directory-configuration"),h=e("#postdivrich"),f=e("#directory-page-profile-ids"),m=e(".wsu-people-directory-options-header"),w=e("#wsu-people-import-organization"),g=e("#wsu-people-import-location"),v=e("#wsu-people-import-wsu-category"),b=e("#wsu-people-import-classification"),k=e("#wsu-people-import-category"),y=e("#wsu-people-import-tag"),C=e("#wsu-people-directory-layout"),x=e("#wsu-people-directory-show-photos"),j=e("#wsu-people-directory-about"),A=e("#wsu-people-directory-link"),S=e(".toggle-select-mode"),B=e(".select-all-people"),D=e(".delete-selected-people"),R=e(".wsu-people-wrapper"),z=e(".wsu-people"),I=e(".person-modal"),H=e(".wsu-person-controls-tooltip"),J=_.template(e("#wsu-person-template").html()),L=[],N=[];e(o).ready(function(){function o(o){return{delay:500,minLength:3,source:function(s,i){e.ajax({url:t.wsuwp_people_edit_page.rest_route+o,data:{search:s.term,per_page:50},success:function(t){i(e.map(t,function(e){return{label:e.name,value:e.slug}}))}})}}}i(),d.on("change",function(){"templates/people.php"===e(this).val()?(u.show(),h.hide()):(u.hide(),"template-builder.php"!==e(this).val()&&h.show())}),w.autocomplete(o("organization")),g.autocomplete(o("location")),v.autocomplete(o("university_category")),b.autocomplete(o("classification")),k.autocomplete(o("categories")),y.autocomplete(o("tags")),e("#wsu-people-import").on("click",function(){var o={per_page:100};""!==w.val()&&(o["filter[wsuwp_university_org]"]=w.val()),""!==g.val()&&(o["filter[wsuwp_university_location]"]=g.val()),""!==v.val()&&(o["filter[wsuwp_university_category]"]=v.val()),""!==b.val()&&(o["filter[classification]"]=b.val()),""!==k.val()&&(o["filter[taxonomy]"]="category",o["filter[term]"]=k.val()),""!==y.val()&&(o["filter[tag]"]=y.val()),z.html("<span class='spinner'></span>"),e.ajax({url:t.wsuwp_people_edit_page.rest_url,data:o}).done(function(e,t,s){var i=parseInt(s.getResponseHeader("x-wp-totalpages"));if(1===i)l(e);else if(i>1)for(var a=e,p=1;p<i;)p++,o.page=p,n(o,a,p,i)})}),m.on("click",function(){var t=e(this).closest(".wsu-people-directory-options"),o=t.children("div");t.hasClass("open")?(t.removeClass("open"),o.slideUp()):(t.addClass("open"),o.slideDown())}),C.on("change",function(){var t=e(this).val();C.find("option").not(":selected").each(function(){R.removeClass(e(this).val())}),R.addClass(t)}),x.on("change",function(){"yes"===e(this).val()?R.addClass("photos"):R.removeClass("photos")}),j.on("change",function(){var t=e(this).val();z.find(".wsu-person").each(function(){var o=e(this).find("div[data-key='"+t+"']"),s=e(this).find(".about");"none"!==t&&o.length?s.html(o.find(".content").html()):s.html("")})}),A.on("change",function(){var t=e(this).val();z.find(".wsu-person").each(function(){var o=e(this).find("div[data-key='personal']");"no"===t||"if_bio"===t&&!o.length?e(this).addClass("no-link").removeClass("link"):e(this).removeClass("no-link").addClass("link")})}),z.sortable({cursor:"move",start:function(e,t){t.placeholder.height(t.item.height())},stop:function(){r()}}),S.on("click",function(){"Bulk Select"===e(this).text()?(e(this).text("Cancel Selection"),B.show(),D.show().prop("disabled",!0),R.addClass("bulk-select"),z.sortable("option","disabled",!0)):(e(this).text("Bulk Select"),B.hide(),D.hide().prop("disabled",!0),R.removeClass("bulk-select"),z.find(".wsu-person").removeClass("selected").attr("aria-checked","false"),z.sortable("option","disabled",!1))}),B.on("click",function(){"Select All"===e(this).text()?(e(this).text("Deselect All"),z.find(".wsu-person").addClass("selected").attr("aria-checked","true"),D.prop("disabled",!1)):(e(this).text("Select All"),z.find(".wsu-person").removeClass("selected").attr("aria-checked","false"),D.prop("disabled",!0))}),z.on("click",".wsu-person",function(){R.is(".bulk-select")&&(e(this).toggleClass("selected"),e(this).hasClass("selected")?e(this).attr("aria-checked","true"):e(this).attr("aria-checked","false"),0<z.find(".selected").length?D.prop("disabled",!1):(B.text("Select All"),D.prop("disabled",!0)),z.find(".wsu-person").length===z.find(".selected").length&&B.text("Deselect All"))}),D.on("click",function(){z.find(".selected").remove(),r()}),z.on("mouseover",".wsu-person-controls button",function(){var e=this.getAttribute("aria-label"),t=this.getBoundingClientRect(),o=z[0].getBoundingClientRect();H.find(".wsu-person-controls-tooltip-inner").html(e),H.css({top:t.bottom-o.top+"px",left:t.right-o.left-H.width()/2-t.width/2+"px"}).show()}),z.on("mouseleave",".wsu-person-controls button",function(){H.hide()}),z.on("click",".wsu-person-edit",function(){e(this).closest(".wsu-person").find(".person-modal-wrapper").addClass("active"),e("body").addClass("person-modal-open"),z.sortable("option","disabled",!0)}),z.on("click",".wsu-person-remove",function(){e(this).closest(".wsu-person").remove(),r()}),z.on("click",".close",function(t){t.target===this&&(e(this).closest(".person-modal-wrapper").removeClass("active"),e("body").removeClass("person-modal-open"),z.sortable("option","disabled",!1))}),I.on("click",".choose > div",function(){e(this).toggleClass("selected"),e(this).closest(".choose").hasClass("multiple")||e(this).siblings().removeClass("selected")}),I.on("click",".person-update",function(){var o=e(this).closest(".wsu-person"),s=e(this).closest(".person-modal-wrapper"),i={action:"person_details",nonce:t.wsuwp_people_edit_page.nonce,page:t.wsuwp_people_edit_page.page_id,post:o.data("post-id")};if(s.find(".person-photos .selected")){var n=s.find(".person-photos .selected");i.photo=n.data("index"),o.find(".photo img").attr("src",n.find("img").attr("src"))}if(s.find(".person-titles .selected")){var l="",a=[],p=s.find(".person-titles .selected .content"),r=p.length;p.each(function(t){a.push(e(this).closest(".selected").data("index")),l+=e(this).html(),t!==r-1&&(l+="<br />")}),i.title=a.join(" "),o.find(".card .title").html(l)}if(s.find(".person-content .selected")){var d=s.find(".person-content .selected");i.about=d.data("key"),o.find(".about").html(d.find(".content").html())}c(i,s)})}),e(".wsu-people-admin-wrapper").hasClass("loading")&&(z.prepend("<p class='description importing-profiles'>Importing profiles, please wait.<span class='spinner'></span><p>"),s())}(jQuery,window,document);