var wsuwp=wsuwp||{};wsuwp.people=wsuwp.people||{},function(b,h,e,v){v.people.rest_response_complete=!1,v.people.titles="",v.people.degrees="",v.people.bio_content={content:"",_wsuwp_profile_bio_unit:"",_wsuwp_profile_bio_university:""},v.people.taxonomy_terms={classification:[],wsuwp_university_category:[],wsuwp_university_location:[],wsuwp_university_org:[]},v.people.populate_editor=function(e){!1!==v.people.rest_response_complete?(h.tinymce.get(e.id).setContent(v.people.bio_content[e.id]),0!==b("#bio_unit .readonly").length&&h.tinymce.get("_wsuwp_profile_bio_unit").setMode("readonly"),0!==b("#bio_university .readonly").length&&h.tinymce.get("_wsuwp_profile_bio_university").setMode("readonly")):setTimeout(v.people.populate_editor.bind(null,e),200)},v.people.populate_person_from_people_directory=function(p){var s=jQuery,e=p.working_titles.length?p.working_titles:[p.position_title],t=p.email_alt?p.email_alt:p.email,o=p.phone_alt?p.phone_alt:p.phone,i=p.office_alt?p.office_alt:p.office,n=p.address_alt?p.address_alt:p.address,r=_.template(s(".wsu-person-repeatable-meta-template").html()),a=s(".wsu-person-add-title"),l=s(".wsu-person-add-degree");s(".wsu-person").attr("data-nid",p.nid),s("#_wsuwp_profile_post_id").val(p.id),s("#_wsuwp_profile_canonical_source").val(p.link),s(".wsu-person .name").text(p.title.rendered).data("original",p.title.rendered),s("[data-for='name']").val(p.title.rendered),s(".wsu-person .email").text(t).data("original",t),s("[data-for='email']").val(t),s(".wsu-person .phone").text(o).data("original",o),s("[data-for='phone']").val(o),s(".wsu-person .office").text(i).data("original",i),s("[data-for='office']").val(i),s(".wsu-person .address").text(n).data("original",n),s("[data-for='address']").val(n),s(".wsu-person .website").text(p.website).data("original",p.website),s("[data-for='website']").val(p.website),v.people.bio_content.content=p.content.rendered,v.people.bio_content._wsuwp_profile_bio_unit=p.bio_unit,v.people.bio_content._wsuwp_profile_bio_university=p.bio_university,h.tinymce.get("content")||(s("#content").val(p.content.rendered),s("#_wsuwp_profile_bio_unit").val(p.bio_unit),s("#_wsuwp_profile_bio_university").val(p.bio_university)),s("#bio_unit .readonly").html(p.bio_unit),s("#bio_university .readonly").html(p.bio_university),v.people.rest_response_complete=!0,s.each(e,function(e,t){var o=s(".contact .title")[e],i=s("#local-display-title");if(o?(s(o).text(t),s("[data-for='title']").val(t)):a.before(r({type:a.data("type"),value:t})),i.append("<option value='"+e+"'>"+t+"</option>"),p.working_titles.length-1===e){var n=i.data("selected").toString();i.attr("size",e+1),1===n.length?i.find("option[value='"+n+"']").prop("selected","selected"):2<n.length&&s.each(n.split(","),function(e,t){i.find("option[value='"+t+"']").prop("selected","selected")})}}),v.people.titles=p.working_titles,s.each(p.degree,function(e,t){var o=s(".contact .degree")[e];o?s(o).text(t).next("input").val(t):l.before(r({type:l.data("type"),value:t}))}),v.people.degrees=p.degree,p._embedded&&0!==p._embedded["wp:photos"]&&s.each(p._embedded["wp:photos"],function(e,t){"id"in t&&v.people.populate_photos(t,e)}),p._embedded&&p._embedded["wp:featuredmedia"]&&0!==p._embedded["wp:featuredmedia"]&&v.people.populate_photos(p._embedded["wp:featuredmedia"][0]),p.taxonomy_terms&&s.each(p.taxonomy_terms,function(o,e){if("category"!==o&&"post_tag"!==o&&e){var i=[];s.each(e,function(e,t){s("#"+o+"-select option").filter(function(){return s(this).text()===t.name}).attr("selected","selected"),s("#"+o+"-select").trigger("change"),i.push(t.name)}),v.people.taxonomy_terms[o]=i}}),s.ajax({url:h.wsuwp_people_edit_profile_secondary.rest_url+"/"+p.id,type:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",h.wsuwp_people_edit_profile_secondary.nonce),e.setRequestHeader("X-WSUWP-UID",h.wsuwp_people_edit_profile_secondary.uid)},error:function(){s(".wsu-person-card [contenteditable='true']").prop("contenteditable",!1),s(".wsu-person-remove").remove(),s(".wsu-person-add-repeatable-meta").remove(),s("#new-tag-post_tag").prop("disabled",!0),h.tinymce.get("content").setMode("readonly")}})},v.people.populate_photos=function(e,t){var o=jQuery,i=_.template(o(".wsu-person-photo-template").html()),n=e.media_details,p=n.sizes?n.sizes.thumbnail.source_url:e.source_url,s=o("#local-display-photo"),r=t===s.data("selected")?" checked='checked'":"";-1===o.inArray(e.id,v.existing_photos())&&(o("button.wsu-person-add-photo").before(i({src:p,id:e.id})),0===o(".wsu-person .photo img").length&&(o(".photo").removeClass("wsu-person-add-photo").prepend("<img src='"+p+"'>"),o(".photo figcaption").text("Manage photo collection")),s.append("<label><input type='radio' name='_use_photo' value='"+t+"'"+r+"/><img src='"+p+"' /></label>"))},b(e).ready(function(){var e=b("#_wsuwp_profile_ad_nid"),g=b("#_wsuwp_profile_post_id").val();h.wsuwp_people_edit_profile_secondary.load_data&&b.ajax({url:h.wsuwp_people_edit_profile_secondary.rest_url,data:{_embed:!0,wsu_nid:e.val()}}).done(function(e){0!==e.length&&v.people.populate_person_from_people_directory(e[0])}),b("#publish").on("click",function(){var e={},t=b(".wsu-person .name"),o=b(".wsu-person .email"),i=b(".wsu-person .phone"),n=b(".wsu-person .office"),p=b(".wsu-person .address"),s=b(".wsu-person .website"),r=b(".wsu-person .title"),a=b(".wsu-person .degree"),l=h.tinymce.get("content"),_=h.tinymce.get("_wsuwp_profile_bio_unit"),d=h.tinymce.get("_wsuwp_profile_bio_university"),u=b("#classification-select option:selected").map(function(){return this.text}).get(),c=b("#wsuwp_university_org-select option:selected").map(function(){return this.text}).get(),w=b("#wsuwp_university_location-select option:selected").map(function(){return this.text}).get(),m=b("#wsuwp_university_category-select option:selected").map(function(){return this.text}).get();if(t.text()!==t.data("original")&&(e.title=t.text()),o.text()!==o.data("original")&&(e.email_alt=o.text()),i.text()!==i.data("original")&&(e.phone_alt=i.text()),n.text()!==n.data("original")&&(e.office_alt=n.text()),p.text()!==p.data("original")&&(e.address_alt=p.text()),s.text()!==s.data("original")&&(e.website=s.text()),r){var f=r.map(function(){return b(this).text()}).get();f.join(",")!==v.people.titles.join(",")&&(e.working_titles=f)}if(a){var y=a.map(function(){return b(this).text()}).get();y.join(",")!==v.people.degrees.join(",")&&(e.degree=y)}l&&l.getContent()!==v.people.bio_content.content&&(e.content=l.getContent()),_&&_.getContent()!==v.people.bio_content._wsuwp_profile_bio_unit&&(e.bio_unit=_.getContent()),d&&d.getContent()!==v.people.bio_content._wsuwp_profile_bio_university&&(e.bio_university=d.getContent()),e.taxonomy_terms={},v.people.terms_match(v.people.taxonomy_terms.classification,u)||(e.taxonomy_terms.classification=0===u.length?["wsuwp_people_empty_terms"]:u),v.people.terms_match(v.people.taxonomy_terms.wsuwp_university_org,c)||(e.taxonomy_terms.wsuwp_university_org=0===c.length?["wsuwp_people_empty_terms"]:c),v.people.terms_match(v.people.taxonomy_terms.wsuwp_university_location,w)||(e.taxonomy_terms.wsuwp_university_location=0===w.length?["wsuwp_people_empty_terms"]:w),v.people.terms_match(v.people.taxonomy_terms.wsuwp_university_category,m)||(e.taxonomy_terms.wsuwp_university_category=0===m.length?["wsuwp_people_empty_terms"]:m),b.isEmptyObject(e)||b.ajax({url:h.wsuwp_people_edit_profile_secondary.rest_url+"/"+g,method:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",h.wsuwp_people_edit_profile_secondary.nonce),e.setRequestHeader("X-WSUWP-UID",h.wsuwp_people_edit_profile_secondary.uid)},data:e})}),v.people.terms_match=function(e,t){return JSON.stringify(e.sort())===JSON.stringify(t.sort())}})}(jQuery,window,document,wsuwp);