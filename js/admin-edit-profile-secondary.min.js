var wsuwp=wsuwp||{};wsuwp.people=wsuwp.people||{},function(e,t,o,i){i.people.rest_response_complete=!1,i.people.titles="",i.people.degrees="",i.people.bio_content={content:"",_wsuwp_profile_bio_unit:"",_wsuwp_profile_bio_university:""},i.people.populate_editor=function(o){!1!==i.people.rest_response_complete?(t.tinymce.get(o.id).setContent(i.people.bio_content[o.id]),0!==e("#bio_unit .readonly").length&&t.tinymce.get("_wsuwp_profile_bio_unit").setMode("readonly"),0!==e("#bio_university .readonly").length&&t.tinymce.get("_wsuwp_profile_bio_university").setMode("readonly")):setTimeout(i.people.populate_editor.bind(null,o),200)},i.people.populate_person_from_people_directory=function(e){var o=jQuery,n=_.template(o(".wsu-person-repeatable-meta-template").html()),a=o(".wsu-person-add-title"),s=o(".wsu-person-add-degree");if(o(".wsu-person").attr("data-nid",e.nid),o("#_wsuwp_profile_post_id").val(e.id),o("#_wsuwp_profile_canonical_source").val(e.link),o(".wsu-person .name").text(e.title.rendered).data("original",e.title.rendered),o("[data-for='name']").val(e.title.rendered),o(".wsu-person .email").text(e.email_alt).data("original",e.email_alt),o("[data-for='email']").val(e.email_alt),o(".wsu-person .phone").text(e.phone_alt).data("original",e.phone_alt),o("[data-for='phone']").val(e.phone_alt),o(".wsu-person .office").text(e.office_alt).data("original",e.office_alt),o("[data-for='office']").val(e.office_alt),o(".wsu-person .address").text(e.address_alt).data("original",e.address_alt),o("[data-for='address']").val(e.address_alt),o(".wsu-person .website").text(e.website).data("original",e.website),o("[data-for='website']").val(e.website),i.people.bio_content.content=e.content.rendered,i.people.bio_content._wsuwp_profile_bio_unit=e.bio_unit,i.people.bio_content._wsuwp_profile_bio_university=e.bio_university,o("#bio_unit .readonly").html(e.bio_unit),o("#bio_university .readonly").html(e.bio_university),i.people.rest_response_complete=!0,o.each(e.working_titles,function(e,t){var i=o(".contact .title")[e];i?(o(i).text(t),o("[data-for='title']").val(t)):a.before(n({type:a.data("type"),value:t}))}),i.people.titles=e.working_titles,""!==o(".use-title").val()){var r=o(".use-title").val().split(" ");o.each(r,function(e,t){o(".contact .title").eq(t).addClass("selected").find(".screen-reader-text").text("Deselect")})}o.each(e.degree,function(e,t){var i=o(".contact .degree")[e];i?o(i).text(t).next("input").val(t):s.before(n({type:s.data("type"),value:t}))}),i.people.degrees=e.degree,e._embedded&&e._embedded["wp:term"]&&0!==e._embedded["wp:term"]&&o.each(e._embedded["wp:term"],function(e,t){t&&o.each(t,function(e,t){"post_tag"===t.taxonomy?o("#post_tag").val(t.name).trigger("change"):(o("#"+t.taxonomy).find("option:contains("+t.name+")").attr("selected","selected"),o("#"+t.taxonomy).trigger("change"))})}),o.ajax({url:t.wsuwp_people_edit_profile_secondary.rest_url+"/"+e.id,type:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",t.wsuwp_people_edit_profile_secondary.nonce),e.setRequestHeader("X-WSUWP-UID",t.wsuwp_people_edit_profile_secondary.uid)},error:function(){o(".wsu-person-card [contenteditable='true']").prop("contenteditable",!1),o(".wsu-person-remove").remove(),o(".wsu-person-add-repeatable-meta").remove(),o("#new-tag-post_tag").prop("disabled",!0),t.tinymce.get("content").setMode("readonly")}})},i.people.populate_photos=function(e){var t=jQuery,o=_.template(t("#photo-template").html()),i=e.media_details,n=i.sizes.thumbnail,a=n?i.sizes.thumbnail.source_url:e.source_url,s=n?i.sizes.thumbnail.width:i.width,r=n?i.sizes.thumbnail.height:i.height;-1===t.inArray(e.id,existing_photos())&&t(".wsuwp-profile-photo-collection").append(o({src:a,width:s,height:r,id:e.id,alt:e.alt,url:e.source_url,title:e.title.rendered,full_width:i.width,full_height:i.height}))},e(o).ready(function(){var o=e("#_wsuwp_profile_ad_nid"),n=e("#_wsuwp_profile_post_id").val();t.wsuwp_people_edit_profile_secondary.load_data&&e.ajax({url:t.wsuwp_people_edit_profile_secondary.rest_url,data:{_embed:!0,wsu_nid:o.val()}}).done(function(e){0!==e.length&&i.people.populate_person_from_people_directory(e[0])}),e(".wsuwp-profile-about-tabs").on("click",".select",function(){var t=e(this).closest("li"),o=e(".use-bio");t.toggleClass("selected"),t.hasClass("selected")?(o.val(t.data("bio")),t.find(".screen-reader-text").text("Deselect"),t.siblings().removeClass("selected").find(".screen-reader-text").text("Select")):(o.val(""),t.find(".screen-reader-text").text("Select"))}),e(".wsu-person-title").on("click",".wsu-person-select",function(){var t=e(this).closest(".wsu-person-repeatable-meta-entry");t.toggleClass("selected");var o=e(".wsu-person-title .selected").map(function(){return e(this).index()}).get();e(".use-title").val(o.join(" ")),t.hasClass("selected")?t.find(".screen-reader-text").text("Deselect"):t.find(".screen-reader-text").text("Select")}),e("#publish").on("click",function(){var o={},a=e(".wsu-person .name"),s=e(".wsu-person .email"),r=e(".wsu-person .phone"),l=e(".wsu-person .office"),p=e(".wsu-person .address"),d=e(".wsu-person .website"),_=e(".wsu-person .title"),u=e(".wsu-person .degree"),c=t.tinymce.get("content"),w=t.tinymce.get("_wsuwp_profile_bio_unit"),f=t.tinymce.get("_wsuwp_profile_bio_university");if(a.text()!==a.data("original")&&(o.title=a.text()),s.text()!==s.data("original")&&(o.email_alt=s.text()),r.text()!==r.data("original")&&(o.phone_alt=r.text()),l.text()!==l.data("original")&&(o.office_alt=l.text()),p.text()!==p.data("original")&&(o.address_alt=p.text()),d.text()!==d.data("original")&&(o.website=d.text()),_){var g=_.map(function(){return e(this).text()}).get();g.join(",")!==i.people.titles.join(",")&&(o.working_titles=g)}if(u){var b=u.map(function(){return e(this).text()}).get();b.join(",")!==i.people.degrees.join(",")&&(o.degree=b)}c&&c.getContent()!==i.people.bio_content.content&&(o.content=c.getContent()),w&&w.getContent()!==i.people.bio_content._wsuwp_profile_bio_unit&&(o.bio_unit=w.getContent()),f&&f.getContent()!==i.people.bio_content._wsuwp_profile_bio_university&&(o.bio_university=f.getContent()),e.isEmptyObject(o)||e.ajax({url:t.wsuwp_people_edit_profile_secondary.rest_url+"/"+n,method:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",t.wsuwp_people_edit_profile_secondary.nonce),e.setRequestHeader("X-WSUWP-UID",t.wsuwp_people_edit_profile_secondary.uid)},data:o})})})}(jQuery,window,document,wsuwp);