var wsuwp=wsuwp||{};wsuwp.people=wsuwp.people||{},function(e,t,o,i){i.people.rest_response_complete=!1,i.people.titles="",i.people.degrees="",i.people.bio_content={content:"",_wsuwp_profile_bio_unit:"",_wsuwp_profile_bio_university:""},i.people.taxonomy_terms={classification:[],wsuwp_university_category:[],wsuwp_university_location:[],wsuwp_university_org:[]},i.people.populate_editor=function(o){!1!==i.people.rest_response_complete?(t.tinymce.get(o.id).setContent(i.people.bio_content[o.id]),0!==e("#bio_unit .readonly").length&&t.tinymce.get("_wsuwp_profile_bio_unit").setMode("readonly"),0!==e("#bio_university .readonly").length&&t.tinymce.get("_wsuwp_profile_bio_university").setMode("readonly")):setTimeout(i.people.populate_editor.bind(null,o),200)},i.people.populate_person_from_people_directory=function(e){var o=jQuery,n=e.working_titles.length?e.working_titles:[e.position_title],p=e.email_alt?e.email_alt:e.email,s=e.phone_alt?e.phone_alt:e.phone,r=e.office_alt?e.office_alt:e.office,a=e.address_alt?e.address_alt:e.address,l=_.template(o(".wsu-person-repeatable-meta-template").html()),d=o(".wsu-person-add-title"),u=o(".wsu-person-add-degree");o(".wsu-person").attr("data-nid",e.nid),o("#_wsuwp_profile_post_id").val(e.id),o("#_wsuwp_profile_canonical_source").val(e.link),o(".wsu-person .name").text(e.title.rendered).data("original",e.title.rendered),o("[data-for='name']").val(e.title.rendered),o(".wsu-person .email").text(p).data("original",p),o("[data-for='email']").val(p),o(".wsu-person .phone").text(s).data("original",s),o("[data-for='phone']").val(s),o(".wsu-person .office").text(r).data("original",r),o("[data-for='office']").val(r),o(".wsu-person .address").text(a).data("original",a),o("[data-for='address']").val(a),o(".wsu-person .website").text(e.website).data("original",e.website),o("[data-for='website']").val(e.website),i.people.bio_content.content=e.content.rendered,i.people.bio_content._wsuwp_profile_bio_unit=e.bio_unit,i.people.bio_content._wsuwp_profile_bio_university=e.bio_university,t.tinymce.get("content")||(o("#content").val(e.content.rendered),o("#_wsuwp_profile_bio_unit").val(e.bio_unit),o("#_wsuwp_profile_bio_university").val(e.bio_university)),o("#bio_unit .readonly").html(e.bio_unit),o("#bio_university .readonly").html(e.bio_university),i.people.rest_response_complete=!0,o.each(n,function(t,i){var n=o(".contact .title")[t],p=o("#local-display-title");if(n?(o(n).text(i),o("[data-for='title']").val(i)):d.before(l({type:d.data("type"),value:i})),p.append("<option value='"+t+"'>"+i+"</option>"),e.working_titles.length-1===t){var s=p.data("selected").toString();p.attr("size",t+1),1===s.length?p.find("option[value='"+s+"']").prop("selected","selected"):2<s.length&&o.each(s.split(","),function(e,t){p.find("option[value='"+t+"']").prop("selected","selected")})}}),i.people.titles=e.working_titles,o.each(e.degree,function(e,t){var i=o(".contact .degree")[e];i?o(i).text(t).next("input").val(t):u.before(l({type:u.data("type"),value:t}))}),i.people.degrees=e.degree,e._embedded&&0!==e._embedded["wp:photos"]&&o.each(e._embedded["wp:photos"],function(e,t){"id"in t&&i.people.populate_photos(t,e)}),e._embedded&&e._embedded["wp:featuredmedia"]&&0!==e._embedded["wp:featuredmedia"]&&i.people.populate_photos(e._embedded["wp:featuredmedia"][0]),e.taxonomy_terms&&o.each(e.taxonomy_terms,function(e,t){if("category"!==e&&"post_tag"!==e&&t){var n=[];o.each(t,function(t,i){o("#"+e+"-select option").filter(function(){return o(this).text()===i.name}).attr("selected","selected"),o("#"+e+"-select").trigger("change"),n.push(i.name)}),i.people.taxonomy_terms[e]=n}}),o.ajax({url:t.wsuwp_people_edit_profile_secondary.rest_url+"/"+e.id,type:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",t.wsuwp_people_edit_profile_secondary.nonce),e.setRequestHeader("X-WSUWP-UID",t.wsuwp_people_edit_profile_secondary.uid)},error:function(){o(".wsu-person-card [contenteditable='true']").prop("contenteditable",!1),o(".wsu-person-remove").remove(),o(".wsu-person-add-repeatable-meta").remove(),o("#new-tag-post_tag").prop("disabled",!0),t.tinymce.get("content").setMode("readonly")}})},i.people.populate_photos=function(e,t){var o=jQuery,n=_.template(o(".wsu-person-photo-template").html()),p=e.media_details,s=p.sizes?p.sizes.thumbnail.source_url:e.source_url,r=o("#local-display-photo"),a=t===r.data("selected")?" checked='checked'":"";-1===o.inArray(e.id,i.existing_photos())&&(o("button.wsu-person-add-photo").before(n({src:s,id:e.id})),0===o(".wsu-person .photo img").length&&(o(".photo").removeClass("wsu-person-add-photo").prepend("<img src='"+s+"'>"),o(".photo figcaption").text("Manage photo collection")),r.append("<label><input type='radio' name='_use_photo' value='"+t+"'"+a+"/><img src='"+s+"' /></label>"))},e(o).ready(function(){var o=e("#_wsuwp_profile_ad_nid"),n=e("#_wsuwp_profile_post_id").val();t.wsuwp_people_edit_profile_secondary.load_data&&e.ajax({url:t.wsuwp_people_edit_profile_secondary.rest_url,data:{_embed:!0,wsu_nid:o.val()}}).done(function(e){0!==e.length&&i.people.populate_person_from_people_directory(e[0])}),e("#publish").on("click",function(){var o={},p=e(".wsu-person .name"),s=e(".wsu-person .email"),r=e(".wsu-person .phone"),a=e(".wsu-person .office"),l=e(".wsu-person .address"),_=e(".wsu-person .website"),d=e(".wsu-person .title"),u=e(".wsu-person .degree"),c=t.tinymce.get("content"),w=t.tinymce.get("_wsuwp_profile_bio_unit"),m=t.tinymce.get("_wsuwp_profile_bio_university"),f=e("#classification-select option:selected").map(function(){return this.text}).get(),y=e("#wsuwp_university_org-select option:selected").map(function(){return this.text}).get(),g=e("#wsuwp_university_location-select option:selected").map(function(){return this.text}).get(),b=e("#wsuwp_university_category-select option:selected").map(function(){return this.text}).get();if(p.text()!==p.data("original")&&(o.title=p.text()),s.text()!==s.data("original")&&(o.email_alt=s.text()),r.text()!==r.data("original")&&(o.phone_alt=r.text()),a.text()!==a.data("original")&&(o.office_alt=a.text()),l.text()!==l.data("original")&&(o.address_alt=l.text()),_.text()!==_.data("original")&&(o.website=_.text()),d){var h=d.map(function(){return e(this).text()}).get();h.join(",")!==i.people.titles.join(",")&&(o.working_titles=h)}if(u){var v=u.map(function(){return e(this).text()}).get();v.join(",")!==i.people.degrees.join(",")&&(o.degree=v)}c&&c.getContent()!==i.people.bio_content.content&&(o.content=c.getContent()),w&&w.getContent()!==i.people.bio_content._wsuwp_profile_bio_unit&&(o.bio_unit=w.getContent()),m&&m.getContent()!==i.people.bio_content._wsuwp_profile_bio_university&&(o.bio_university=m.getContent()),o.taxonomy_terms={},i.people.terms_match(i.people.taxonomy_terms.classification,f)||(o.taxonomy_terms.classification=0===f.length?["wsuwp_people_empty_terms"]:f),i.people.terms_match(i.people.taxonomy_terms.wsuwp_university_org,y)||(o.taxonomy_terms.wsuwp_university_org=0===y.length?["wsuwp_people_empty_terms"]:y),i.people.terms_match(i.people.taxonomy_terms.wsuwp_university_location,g)||(o.taxonomy_terms.wsuwp_university_location=0===g.length?["wsuwp_people_empty_terms"]:g),i.people.terms_match(i.people.taxonomy_terms.wsuwp_university_category,b)||(o.taxonomy_terms.wsuwp_university_category=0===b.length?["wsuwp_people_empty_terms"]:b),e.isEmptyObject(o)||e.ajax({url:t.wsuwp_people_edit_profile_secondary.rest_url+"/"+n,method:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",t.wsuwp_people_edit_profile_secondary.nonce),e.setRequestHeader("X-WSUWP-UID",t.wsuwp_people_edit_profile_secondary.uid)},data:o})}),i.people.terms_match=function(e,t){return JSON.stringify(e.sort())===JSON.stringify(t.sort())}})}(jQuery,window,document,wsuwp);